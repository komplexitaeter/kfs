<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Running Bot</title>
</head>
<body>
<div id="simulation_id"></div>
<div id="session_key"></div>
<div id="fetch_count"></div>
<div id="last_execution_time"></div>
<div id="console"></div>
<script>
    let last_execution_time = '';
    let fetch_count = 0;
    const gServerInterval = 500;

    function getParam(param_name){
        let url = new URL(window.location.href);
        return url.searchParams.get(param_name);
    }

    function refreshBoard(simulation_id, session_key) {

        let url = './get_board.php?simulation_id=' + simulation_id
            + '&session_key=' + session_key
            + '&execution_time=' + last_execution_time;

        let start_time = performance.now();

        let request = new XMLHttpRequest();
        request.open("GET", url, false);
        request.send();

        let stop_time = performance.now();
        last_execution_time = Math.round(stop_time - start_time);

        document.getElementById("last_execution_time").textContent = "last_execution_time: "+last_execution_time;
        document.getElementById("console").textContent += ". ";
        fetch_count++;
        document.getElementById("fetch_count").textContent = "fetch_count:" + fetch_count.toString();

        let serverInterval;
        if (last_execution_time>=gServerInterval) {
            serverInterval = 0;
        }
        else {
            serverInterval = gServerInterval - last_execution_time;
        }

        setTimeout(function(){
            refreshBoard(simulation_id, session_key);
        }, serverInterval);

    }

    document.getElementById("simulation_id").textContent = "simulation_id: "+getParam("simulation_id");
    document.getElementById("session_key").textContent = "session_key: "+getParam("session_key");

    refreshBoard(getParam("simulation_id"), getParam("session_key"));


</script>
</body>
</html>